<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Rater | AI-Powered Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for creating beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a polished look */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .chart-container {
            position: relative;
            height: 180px;
            width: 180px;
        }

        /* Custom scrollbar for a better dark mode experience */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 10px;
        }

        .dark ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        /* Smooth transitions for elements appearing/disappearing */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        .fade-out {
            animation: fadeOut 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
                display: none;
            }
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

    <!-- Navbar -->
    <nav
        class="bg-white/60 dark:bg-slate-900/60 backdrop-blur-md sticky top-0 z-50 border-b border-slate-200 dark:border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <svg class="h-8 w-8 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="text-xl font-bold ml-2 text-slate-900 dark:text-white">Resume Rater</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="theme-toggle"
                        class="p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg id="theme-icon-light" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <svg id="theme-icon-dark" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                        </svg>
                    </button>
                    <button id="export-button" disabled
                        class="px-4 py-2 bg-indigo-500 text-white font-semibold rounded-md shadow-sm hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-indigo-300 dark:disabled:bg-indigo-800 disabled:cursor-not-allowed disabled:opacity-50 transition-all">
                        Export Report
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Hero/Upload Section -->
        <section id="hero-section" class="text-center fade-in">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold tracking-tight text-slate-900 dark:text-white">
                Your career story, <span class="text-indigo-500">perfected.</span>
            </h1>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400">
                Get instant, AI-powered feedback on your resume to land your dream job. Upload your resume to begin.
            </p>
            <div id="drop-zone"
                class="mt-10 max-w-3xl mx-auto p-8 border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-2xl cursor-pointer hover:border-indigo-500 dark:hover:border-indigo-500 hover:bg-slate-100/50 dark:hover:bg-slate-800/50 transition-all">
                <input type="file" id="file-input" class="hidden" accept=".pdf,.doc,.docx,.txt">
                <div id="upload-prompt" class="flex flex-col items-center justify-center space-y-4">
                    <svg class="w-16 h-16 text-slate-400 dark:text-slate-500" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 15l-3-3m0 0l3-3m-3 3h12" />
                    </svg>
                    <p class="text-lg font-semibold text-slate-700 dark:text-slate-300">Drag & Drop Your Resume Here</p>
                    <p class="text-slate-500 dark:text-slate-400">or <span class="text-indigo-500 font-semibold">click
                            to browse</span></p>
                    <p class="text-xs text-slate-400 dark:text-slate-500">PDF, DOCX, or TXT (Max 10MB)</p>
                </div>
                <div id="loading-indicator" class="hidden flex-col items-center justify-center space-y-4">
                    <svg class="animate-spin h-12 w-12 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <p class="text-lg font-semibold text-slate-700 dark:text-slate-300">Analyzing Your Resume...</p>
                    <p class="text-slate-500 dark:text-slate-400">This may take a moment. We're working our AI magic!
                    </p>
                </div>
            </div>
            <div id="error-message" class="mt-4 text-red-500 font-medium hidden"></div>
        </section>

        <!-- Analysis Report Section -->
        <section id="analysis-section" class="hidden space-y-12">
            <!-- Populated by JavaScript -->
            <div id="headline-container" class="text-center"></div>
            <div id="scores-container"></div>
            <div id="keywords-container"></div>
            <div id="analytics-container"></div>
            <div id="timeline-container"></div>
            <div id="suggestions-container"></div>
            <div id="examples-container"></div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const uploadPrompt = document.getElementById('upload-prompt');
            const loadingIndicator = document.getElementById('loading-indicator');
            const heroSection = document.getElementById('hero-section');
            const analysisSection = document.getElementById('analysis-section');
            const exportButton = document.getElementById('export-button');
            const errorMessage = document.getElementById('error-message');

            // --- API Configuration ---
            const API_URL = 'http://localhost:8000/upload-resume'; // IMPORTANT: Change if your backend is hosted elsewhere

            // --- Theme Management ---
            const applyTheme = (theme) => {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            };

            themeToggle.addEventListener('click', () => {
                const isDark = !document.documentElement.classList.contains('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                applyTheme(isDark ? 'dark' : 'light');
            });

            const savedTheme = localStorage.getItem('theme') || 'light';
            applyTheme(savedTheme);


            // --- File Upload Logic ---
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-indigo-500', 'bg-slate-100/50', 'dark:bg-slate-800/50');
            });
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-indigo-500', 'bg-slate-100/50', 'dark:bg-slate-800/50');
            });
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-indigo-500', 'bg-slate-100/50', 'dark:bg-slate-800/50');
                const file = e.dataTransfer.files[0];
                handleFile(file);
            });

            const handleFile = (file) => {
                if (!file) return;
                // File type/size validation
                if (file.size > 10 * 1024 * 1024) {
                    showError("File is too large. Maximum size is 10MB.");
                    return;
                }
                uploadAndAnalyze(file);
            };

            const showError = (message) => {
                errorMessage.textContent = `Error: ${message}`;
                errorMessage.classList.remove('hidden');
                loadingIndicator.style.display = 'none';
                uploadPrompt.style.display = 'flex';
            };

            // --- API Request and Analysis ---
            const uploadAndAnalyze = async (file) => {
                const formData = new FormData();
                formData.append('file', file);

                // Show loading state
                uploadPrompt.style.display = 'none';
                loadingIndicator.style.display = 'flex';
                errorMessage.classList.add('hidden');
                analysisSection.classList.add('hidden');

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        let errorData;
                        try {
                            errorData = await response.json();
                        } catch {
                            errorData = {};
                        }
                        throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();

                    // Hide hero and show analysis
                    heroSection.classList.remove('fade-in');
                    heroSection.classList.add('hidden');
                    // Do NOT clear analysisSection.innerHTML, just show it
                    analysisSection.classList.remove('hidden');
                    analysisSection.classList.add('fade-in');

                    displayAnalysis(data);

                } catch (error) {
                    console.error('Analysis failed:', error);
                    showError(error.message);
                } finally {
                    // Hide loading indicator (handled by showing analysis or error)
                    fileInput.value = ''; // Reset file input
                    loadingIndicator.style.display = 'none';
                }
            };

            // --- UI Rendering Functions ---
            const displayAnalysis = (data) => {
                renderHeadline(data.headline);
                renderScores(data.scores);
                renderKeywords(data.keywords);
                renderAnalytics(data.analytics);
                renderTimeline(data.career_timeline);
                renderSuggestions(data.improvement_suggestions);
                renderExamples(data.before_and_after_examples);

                exportButton.disabled = false;
            };

            const createSectionHeader = (title, subtitle) => `
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white">${title}</h2>
                    <p class="mt-2 text-lg text-slate-600 dark:text-slate-400">${subtitle}</p>
                </div>`;

            const renderHeadline = (headline) => {
                document.getElementById('headline-container').innerHTML = `
                    <h1 class="text-4xl font-extrabold tracking-tight text-indigo-500">${headline}</h1>
                 `;
            };

            const renderScores = (scores) => {
                const container = document.getElementById('scores-container');
                container.innerHTML = `
                    ${createSectionHeader('Overall Analysis', 'A quick look at your resume\'s key metrics.')}
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                        <!-- Main Score Gauge -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-1 flex flex-col items-center justify-center p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                             <h3 class="text-lg font-semibold text-slate-900 dark:text-white mb-4">Overall Score</h3>
                             <div class="chart-container"><canvas id="overallScoreChart"></canvas></div>
                        </div>
                        <!-- Other Scores -->
                        <div class="col-span-1 md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-3 gap-6">
                            ${createScoreCard('ATS Friendliness', scores.ats_friendliness, 100)}
                            ${createScoreCard('Layout & Formatting', scores.layout_and_formatting, 100)}
                            ${createScoreCard('Impact & Quantification', scores.impact_and_quantification, 100)}
                        </div>
                    </div>
                `;

                // Render Charts
                setTimeout(() => createGaugeChart('overallScoreChart', scores.overall, 10, true), 0);
            };

            const createScoreCard = (title, value, max) => `
                <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg flex flex-col items-center justify-center">
                    <h4 class="text-md font-semibold text-slate-600 dark:text-slate-300 mb-3">${title}</h4>
                    <span class="text-4xl font-bold text-slate-900 dark:text-white">${value}<span class="text-2xl text-slate-400">/${max}</span></span>
                </div>
            `;

            const renderKeywords = (keywords) => {
                document.getElementById('keywords-container').innerHTML = `
                     ${createSectionHeader('Keywords & Skills', 'The most prominent skills detected in your resume.')}
                     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                         <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                            <h3 class="font-semibold mb-4 text-slate-900 dark:text-white">Top Technical Skills</h3>
                            <div class="flex flex-wrap gap-2">
                                ${(keywords.top_technical_skills || []).map(skill => `<span class="bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 text-sm font-medium px-3 py-1 rounded-full">${skill}</span>`).join('')}
                            </div>
                         </div>
                         <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                            <h3 class="font-semibold mb-4 text-slate-900 dark:text-white">Top Soft Skills</h3>
                            <div class="flex flex-wrap gap-2">
                                ${(keywords.top_soft_skills || []).map(skill => `<span class="bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-300 text-sm font-medium px-3 py-1 rounded-full">${skill}</span>`).join('')}
                            </div>
                         </div>
                     </div>
                `;
            };

            const renderAnalytics = (analytics) => {
                const lengthSentimentIcon = {
                    'Ideal': '<svg class="w-6 h-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
                    'Too Long': '<svg class="w-6 h-6 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>',
                    'Too Short': '<svg class="w-6 h-6 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>'
                };

                document.getElementById('analytics-container').innerHTML = `
                     ${createSectionHeader('Detailed Analytics', 'A deeper dive into your resume\'s content.')}
                     <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg col-span-1 md:col-span-2">
                            <h3 class="font-semibold mb-4 text-slate-900 dark:text-white">Action Verb Usage</h3>
                            <div class="flex items-center space-x-6 mb-4">
                                <div><span class="text-3xl font-bold">${analytics.action_verbs.count}</span><span class="ml-2 text-slate-500">Total</span></div>
                                <div><span class="text-3xl font-bold">${analytics.action_verbs.unique_count}</span><span class="ml-2 text-slate-500">Unique</span></div>
                            </div>
                            <canvas id="actionVerbsChart" height="100"></canvas>
                        </div>
                        <div class="space-y-6 col-span-1">
                             <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                                <h4 class="font-semibold mb-2 text-slate-900 dark:text-white">Readability</h4>
                                <p class="text-2xl font-bold">${analytics.readability.grade_level}</p>
                                <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">${analytics.readability.score_explanation}</p>
                             </div>
                             <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                                <h4 class="font-semibold mb-2 text-slate-900 dark:text-white">Resume Length</h4>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-2xl font-bold">${analytics.resume_length.words} <span class="text-lg font-medium text-slate-500">words</span></p>
                                        <p class="text-sm text-slate-500">${analytics.resume_length.pages} page(s)</p>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        ${lengthSentimentIcon[analytics.resume_length.sentiment]}
                                        <span class="font-semibold">${analytics.resume_length.sentiment}</span>
                                    </div>
                                </div>
                             </div>
                        </div>
                     </div>
                `;
                setTimeout(() => createBarChart('actionVerbsChart', analytics.action_verbs.usage_frequency), 0);
            };

            const renderTimeline = (timeline) => {
                if (!timeline || timeline.length === 0) {
                    document.getElementById('timeline-container').innerHTML = '';
                    return;
                }
                document.getElementById('timeline-container').innerHTML = `
                    ${createSectionHeader('Career Timeline', 'Your professional journey at a glance.')}
                    <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                        <div class="relative border-l-2 border-slate-200 dark:border-slate-700">
                        ${timeline.map(job => `
                            <div class="mb-8 ml-6">
                                <span class="absolute flex items-center justify-center w-6 h-6 bg-indigo-200 rounded-full -left-3 ring-8 ring-white dark:ring-slate-800 dark:bg-indigo-900">
                                    <svg class="w-3 h-3 text-indigo-600 dark:text-indigo-400" fill="currentColor" viewBox="0 0 20 20"><path d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4zM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10z"></path></svg>
                                </span>
                                <h3 class="flex items-center mb-1 text-lg font-semibold text-slate-900 dark:text-white">${job.role} at <span class="text-indigo-500 ml-2">${job.company}</span></h3>
                                <time class="block mb-2 text-sm font-normal leading-none text-slate-400 dark:text-slate-500">${job.start_date} - ${job.end_date}</time>
                                <ul class="list-disc ml-5 mt-2 space-y-1 text-slate-600 dark:text-slate-400">
                                    ${(job.achievements || []).map(ach => `<li>${ach}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                        </div>
                    </div>
                `;
            };

            const renderSuggestions = (suggestions) => {
                const severityColors = {
                    'High': 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300',
                    'Medium': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300',
                    'Low': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300',
                };
                document.getElementById('suggestions-container').innerHTML = `
                    ${createSectionHeader('Actionable Suggestions', 'Key improvements to make your resume stand out.')}
                    <div class="space-y-4">
                    ${(suggestions || []).map(s => `
                        <div class="p-4 bg-white dark:bg-slate-800 rounded-xl shadow-lg flex items-start space-x-4">
                            <span class="flex-shrink-0 inline-flex items-center justify-center h-8 w-8 rounded-full ${severityColors[s.severity] || ''}">
                                <span class="text-sm font-bold">${s.severity ? s.severity[0] : ''}</span>
                            </span>
                            <div>
                                <h4 class="font-semibold text-slate-900 dark:text-white">${s.section}</h4>
                                <p class="text-slate-600 dark:text-slate-400">${s.suggestion}</p>
                            </div>
                        </div>
                    `).join('')}
                    </div>
                 `;
            };

            const renderExamples = (examples) => {
                document.getElementById('examples-container').innerHTML = `
                     ${createSectionHeader('Before & After', 'See how small changes can make a big impact.')}
                     <div class="space-y-6">
                     ${(examples || []).map(ex => `
                        <div class="p-6 bg-white dark:bg-slate-800 rounded-2xl shadow-lg">
                            <h4 class="font-bold text-lg mb-4 text-slate-900 dark:text-white">Improvement for: <span class="text-indigo-500">${ex.section}</span></h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <p class="font-semibold mb-2 text-red-500">Before:</p>
                                    <p class="text-slate-500 dark:text-slate-400 p-3 bg-slate-100 dark:bg-slate-700/50 rounded-md italic">"${ex.original}"</p>
                                </div>
                                 <div>
                                    <p class="font-semibold mb-2 text-green-500">After:</p>
                                    <p class="text-slate-600 dark:text-slate-300 p-3 bg-green-50 dark:bg-green-900/50 rounded-md">"${ex.improved}"</p>
                                </div>
                            </div>
                            <p class="mt-4 text-sm text-slate-500 dark:text-slate-400"><span class="font-semibold">Reason:</span> ${ex.reason}</p>
                        </div>
                     `).join('')}
                     </div>
                `;
            };

            // --- Charting Functions ---
            const createGaugeChart = (canvasId, value, max, isMain = false) => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const scorePercentage = (value / max) * 100;

                const getGradient = (percentage) => {
                    const g = ctx.createLinearGradient(0, 0, 180, 180);
                    if (percentage < 50) {
                        g.addColorStop(0, '#f87171'); // red-400
                        g.addColorStop(1, '#fb923c'); // orange-400
                    } else if (percentage < 80) {
                        g.addColorStop(0, '#fb923c'); // orange-400
                        g.addColorStop(1, '#a3e635'); // lime-400
                    } else {
                        g.addColorStop(0, '#a3e635'); // lime-400
                        g.addColorStop(1, '#4ade80'); // green-400
                    }
                    return g;
                };

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        datasets: [{
                            data: [value, max - value],
                            backgroundColor: [getGradient(scorePercentage), document.documentElement.classList.contains('dark') ? '#334155' : '#e2e8f0'],
                            borderColor: [getGradient(scorePercentage), 'transparent'],
                            borderWidth: 1,
                            circumference: 270,
                            rotation: 225,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '80%',
                        plugins: {
                            tooltip: { enabled: false },
                            datalabels: {
                                color: document.documentElement.classList.contains('dark') ? '#fff' : '#0f172a',
                                formatter: () => `${value}\n/${max}`,
                                font: {
                                    size: 32,
                                    weight: 'bold',
                                },
                                textAlign: 'center'
                            }
                        }
                    },
                    plugins: [ChartDataLabels]
                });
            };

            const createBarChart = (canvasId, data) => {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                const isDarkMode = document.documentElement.classList.contains('dark');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: (data || []).map(d => d.verb),
                        datasets: [{
                            label: 'Usage Frequency',
                            data: (data || []).map(d => d.count),
                            backgroundColor: 'rgba(99, 102, 241, 0.6)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                grid: { color: isDarkMode ? '#334155' : '#e2e8f0' },
                                ticks: { color: isDarkMode ? '#94a3b8' : '#64748b', precision: 0 }
                            },
                            y: {
                                grid: { display: false },
                                ticks: { color: isDarkMode ? '#94a3b8' : '#64748b' }
                            }
                        }
                    }
                });
            };

            // --- Export Functionality ---
            exportButton.addEventListener('click', () => {
                window.print();
            });

        });
    </script>
</body>

</html>